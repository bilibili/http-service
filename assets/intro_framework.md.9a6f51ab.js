import{d as I,h as r,g as S,o as u,c as d,k as s,n as F,L as g,F as _,A as k,Z as L,$ as P,t as T,z as M,a as w,D as A,N as B}from"./chunks/framework.8cca3e42.js";const N="/http-service/assets/wp.d6208a21.svg",H="/http-service/assets/onion.e8e8ff24.webp",O={class:"framework-experience"},R=["onMouseenter","title"],W={class:"fe-onion-layer-name"},z={class:"fe-console"},V={class:"fe-console-content"},J=["innerHTML"],x=100,K=I({__name:"FrameworkExperience",setup(E){const D=r([]),a=S(()=>{const n=[{name:"Retry",builtin:!0},{name:"Init Context",builtin:!0},...D.value,{name:"Res Data",builtin:!0},{name:"Body",builtin:!0},{name:"Timeout",builtin:!0},{name:"Fetch",builtin:!0}],t=["rgb(75, 0, 130)","rgb(109, 0, 137)","rgb(141, 0, 142)","rgb(171, 0, 146)","rgb(200, 0, 147)","rgb(228, 0, 148)"];return n.map((e,l)=>Object.assign(e,{color:t[l]}))}),o=r(-1);function $(n){if(y.value)return{width:x+"px",height:"300px",left:(x+20)*n+"px",top:0};const t=a.value.length,e=(t-n)/t;return{zIndex:n,transform:"translate(-50%, -50%)",width:e*600+"px",height:e*500+"px"}}function q(n){const t=o.value===n;return{backgroundColor:a.value[n].color,transform:`scale(${t?1.05:1}) `,borderRadius:y.value?"8px":""}}const y=r(!1),h=n=>new Promise(t=>{setTimeout(()=>{t(!0)},n*1e3)});function m(n,t){const{name:e,color:l}=n;return e==="Fetch"&&(t==="before"?t="start":t="done"),`[<em style="color:${l}">${e}</em>]request ${t}`}async function C(){v.value=0,f.value=0,b.value=0,p.value=[],await h(0),y.value=!0,i.value=!0;const n=a.value.length,t=x+20;v.value=n*t-20;let e=0;o.value=e,p.value.push(m(a.value[e],"before"));let l=setInterval(()=>{e++,p.value.push(m(a.value[e],"before")),o.value=e},500);await h(2.7),clearInterval(l),f.value=120,await h(1.2),b.value=n*t-20,p.value.push(m(a.value[e],"after")),l=setInterval(()=>{p.value.push(m(a.value[e],"after")),e--,o.value=e},500),await h(3),clearInterval(l),i.value=!1,o.value=-1}const v=r(0),f=r(0),b=r(0),i=r(!1),p=r([]),c=r(["linear-gradient(90deg, rgb(0, 191, 255), rgb(0, 177, 255))","linear-gradient(rgb(0, 177, 255), rgb(0, 161, 255))","linear-gradient(270deg, rgb(0, 161, 255), rgb(30, 144, 255))"]);return(n,t)=>(u(),d("div",O,[s("div",{class:"fe-try",onClick:C},"Try it!"),s("div",{class:"fe-onion",onMouseleave:t[0]||(t[0]=e=>o.value=-1)},[s("div",{class:F(["fe-onion-line1",i.value&&"animating"]),style:g({top:"80px",height:"20px",width:v.value+"px",backgroundImage:`linear-gradient(90deg, ${c.value[0]},${c.value[1]})`})},null,6),s("div",{class:F(["fe-onion-line2",i.value&&"animating"]),style:g({left:v.value-20+"px",width:"20px",top:"100px",height:f.value+"px",backgroundImage:`linear-gradient(180deg,${c.value[1]},${c.value[2]})`})},null,6),s("div",{class:F(["fe-onion-line3",i.value&&"animating"]),style:g({right:600-v.value+20+"px",width:b.value?b.value-20+"px":"",height:"20px",top:80+f.value+"px",backgroundImage:`linear-gradient(270deg,${c.value[2]},${c.value[3]})`})},null,6),(u(!0),d(_,null,k(a.value,(e,l)=>(u(),d("div",{class:"fe-onion-layer",onMouseenter:()=>{i.value||(o.value=l)},key:e.name,title:e.name,style:g($(l))},[s("div",{class:"fe-onion-layer-halo",style:g(q(l))},null,4),s("div",W,T(e.name),1)],44,R))),128))],32),L(s("div",z,[t[1]||(t[1]=s("div",{class:"fe-console-header"},"terminal",-1)),s("div",V,[(u(!0),d(_,null,k(p.value,(e,l)=>(u(),d("div",{class:"fe-console-line",key:l,innerHTML:e},null,8,J))),128))])],512),[[P,y.value]])]))}});const j={id:"框架设计",tabindex:"-1"},Q=JSON.parse('{"title":"框架设计","description":"","frontmatter":{},"headers":[],"relativePath":"intro/framework.md","filePath":"intro/framework.md"}'),G={name:"intro/framework.md"},U=Object.assign(G,{setup(E){return(D,a)=>{const o=M("Badge");return u(),d("div",null,[s("h1",j,[a[0]||(a[0]=w("框架设计 ",-1)),A(o,{type:"tip",text:"概念介绍"}),a[1]||(a[1]=w()),a[2]||(a[2]=s("a",{class:"header-anchor",href:"#框架设计","aria-label":'Permalink to "框架设计 <Badge type="tip" text="概念介绍" />"'},"​",-1))]),a[3]||(a[3]=B(`<p>我们采用了洋葱模式来设计框架，<a href="#模型图">此处跳转</a></p><h2 id="仿真体验" tabindex="-1">仿真体验 <a class="header-anchor" href="#仿真体验" aria-label="Permalink to &quot;仿真体验&quot;">​</a></h2><p>我们假设每个中间件的实现均为:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">handler</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[MIDDLEWARE_NAME]request before</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[MIDDLEWARE_NAME]request after</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,4)),A(K),a[4]||(a[4]=B('<h2 id="设计过程" tabindex="-1">设计过程 <a class="header-anchor" href="#设计过程" aria-label="Permalink to &quot;设计过程&quot;">​</a></h2><ul><li><strong>与服务端对比</strong></li></ul><table><thead><tr><th style="text-align:center;">端</th><th style="text-align:center;">语言</th><th style="text-align:center;">特点</th></tr></thead><tbody><tr><td style="text-align:center;">前端</td><td style="text-align:center;">JS(TS)/Node</td><td style="text-align:center;">偏灵活，动态</td></tr><tr><td style="text-align:center;">后端</td><td style="text-align:center;">Go/Java</td><td style="text-align:center;">偏稳固，静态</td></tr></tbody></table><ul><li><strong>Register</strong></li></ul><p>在注册能力上，后端选择在服务启动时一次性初始化所有插件/中间件， 我们选择保留前端业务灵活、语言动态的特点</p><p><strong>因此我们有两个允许：</strong></p><ol><li>允许用户在发起请求时，携带该次请求所需要的临时中间件</li><li>允许中间件内部依赖按需加载</li></ol><p>例如：</p><ol><li>可以在需要进行风控验证的接口请求时携带风控验证中间件</li><li>风控验证中间件所依赖的验证SDK可以先不进行初始化，实际触发时再去加载执行</li></ol><p>除了以上，我们也要遵守几个原则：</p><ol><li>对一个模块下的公共能力尽量进行最大范围的全局初始化</li><li>每个实例要有明显的使用划分，避免混用，有条件的全局使用一个实例（也取决于前端应用的场景，请灵活决策）</li></ol><h2 id="模型图" tabindex="-1">模型图 <a class="header-anchor" href="#模型图" aria-label="Permalink to &quot;模型图&quot;">​</a></h2><h3 id="http-service-的洋葱模型" tabindex="-1">HTTP Service 的洋葱模型 <a class="header-anchor" href="#http-service-的洋葱模型" aria-label="Permalink to &quot;HTTP Service 的洋葱模型&quot;">​</a></h3><p><img src="'+N+'" alt="洋葱模型"></p><h3 id="koa-的洋葱模型" tabindex="-1">KOA 的洋葱模型 <a class="header-anchor" href="#koa-的洋葱模型" aria-label="Permalink to &quot;KOA 的洋葱模型&quot;">​</a></h3><p><img src="'+H+'" alt="洋葱模型"></p>',16))])}}});export{Q as __pageData,U as default};
